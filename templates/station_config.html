<!DOCTYPE html>
<html>

<head>
    {% include '_meta.html' %}
</head>

<body class="flex flex-col color_theme_bg">
    {% include '_nav_bar.html' %}

    <main class="flex flex-row h-full">
        {% include '_side_menu_bar.html' %}

        <div class="container h-full p-4 mx-auto rounded-lg lg:ml-80">
            <div class="grid grid-cols-1 gap-2 md:grid-cols-2">
                <!-- GATE IN -->
                <div class="w-full">
                    <div class="p-2 card color_widget_theme_bg">

                        <div class="flex flex-col gap-2">
                            <div class="flex gap-2">
                                <div class="w-2/3">
                                    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Gate In Station No.
                                        <span id="input_config_gateway_in_id"></span>
                                    </label>
                                    <select id="input_config_gateway_in_name" onchange="select_gate_in_chang()"
                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                    </select>
                                </div>
                                <button class="w-1/3 border-blue-500 btn_block text_warning" onclick="submit_config_gate_in()">
                                    <span class="ml-2 ">Apply</span>
                                    <i class="fa-regular fa-2x fa-circle-check"></i>
                                </button>

                            </div>
                            <figure><img id="input_config_gateway_in_image" src="" class="w-2/3 mx-auto rounded-lg" /></figure>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Type</label>
                                <input type="text" id="input_config_gateway_in_type" value="Type" readonly
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 ">
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Date Create</label>
                                <input type="text" id="input_config_gateway_in_date_created" value="status" readonly
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 ">
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Status</label>
                                <input type="text" id="input_config_gateway_in_status" value="status" readonly
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 ">
                            </div>

                            <div class="">
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Remark</label>
                                <textarea readonly rows="4"
                                    class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                    placeholder="หมายเหตุ" id="input_config_gateway_in_remark"></textarea>
                            </div>

                        </div>
                        <!-- GATE IN DEFAULT SERVICES FEE -->
                        <div class="p-4 my-2 border-2 border-red-500 rounded-lg color_widget_theme_bg">
                            <div class="flex flex-col gap-2">
                                <div class="flex gap-2">
                                    <div class="w-2/3">
                                        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Gate IN Services Fee(ค่าบริการตั้งต้น)
                                        </label>
                                        <select id="input_config_gate_in_service_fee" onchange="show_gate_in_services_fee()"
                                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                        </select>
                                    </div>
                                    <button class="w-1/3 border-blue-500 btn_block text_warning" onclick="submit_config_gate_in_service_fee()">
                                        <span class="ml-2 ">Apply</span>
                                        <i class="fa-regular fa-2x fa-circle-check"></i>
                                    </button>
                                </div>

                                <div class="">
                                    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Remark</label>
                                    <textarea readonly rows="4"
                                        class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                        placeholder="หมายเหตุ" id="input_config_service_fee_detail"></textarea>
                                </div>

                            </div>
                        </div>
                    </div>


                </div>
                <!-- GATE OUT -->
                <div class="w-full">
                    <div class="p-2 card color_widget_theme_bg">
                        <div class="flex flex-col gap-2">
                            <div class="flex gap-2">
                                <div class="w-2/3">
                                    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Gate Out Station No.
                                        <span id="input_config_gateway_out_id"></span>
                                    </label>
                                    <select id="input_config_gateway_out_name" onchange="select_gate_out_chang()"
                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                                    </select>
                                </div>
                                <button class="w-1/3 border-blue-500 btn_block text_warning" onclick="submit_config_gate_out()">
                                    <span class="ml-2 ">Apply</span>
                                    <i class="fa-regular fa-2x fa-circle-check"></i>
                                </button>
                            </div>

                            <figure><img id="input_config_gateway_out_image" src="" class="w-2/3 mx-auto rounded-lg" /></figure>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Type</label>
                                <input type="text" id="input_config_gateway_out_type" value="Type" readonly
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 ">
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Date Create</label>
                                <input type="text" id="input_config_gateway_out_date_created" value="status" readonly
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 ">
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Status</label>
                                <input type="text" id="input_config_gateway_out_status" value="status" readonly
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 ">
                            </div>

                            <div class="">
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Remark</label>
                                <textarea readonly rows="4"
                                    class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                    placeholder="หมายเหตุ" id="input_config_gateway_out_remark"></textarea>
                            </div>

                        </div>
                    </div>

                </div>


            </div>

        </div>

    </main>
    {% include '_footer.html' %}
</body>
{% include '_script.html' %}

<script src="/static/plugins/serial_port/serial_device.js?t={{now}}"></script>
<script>

    print_info(info_text("GATE_IN_ID :" + localStorage.getItem('GATE_IN_ID')));
    print_info(info_text("GATE_OUT_ID :" + localStorage.getItem('GATE_OUT_ID')));
    print_info(info_text("GATE_IN_SERVICES_FEE_ID :" + localStorage.getItem('GATE_IN_SERVICES_FEE')));


    let GATEWAY_LIST = null;
    let SERVICES_FEE = null;
    const SELECT_GATE_IN = document.getElementById("input_config_gateway_in_name");
    const SELECT_GATE_OUT = document.getElementById("input_config_gateway_out_name");
    const SELECT_GATE_IN_SERVICES_FEE = document.getElementById("input_config_gate_in_service_fee");
    print_info("Station Config");
    async function setting_station() {
        try {
            let _result = await fetchApi("/api/function/gateway_list/", "get", null, "json");
            if (_result.success) {
                GATEWAY_LIST = _result.data;
                //print_info(GATEWAY_LIST);
            }
            let gateway_in_list = "";
            let gateway_out_list = "";
            const gate_in_match = ["IN", "IN-OUT"];
            const gate_out_match = ["OUT", "IN-OUT"];
            await GATEWAY_LIST.forEach((value, index, array) => {
                const _gateway = value.GateWay;
                //print_info(_gateway);
                if (gate_in_match.includes(_gateway.type)) {
                    const _t_op = `<option value="${_gateway.id}">${_gateway.name}</option>`;
                    gateway_in_list += _t_op;
                }
                if (gate_out_match.includes(_gateway.type)) {
                    const _t_op = `<option value="${_gateway.id}">${_gateway.name}</option>`;
                    gateway_out_list += _t_op;
                }

            })
            _result = await fetchApi("/api/service_fees/", "get", null, "json");
            if (_result.success) {
                SERVICES_FEE = _result.data;
                //print_info(GATEWAY_LIST);
                let fervices_fee_op = "";
                for (const _services_fee of SERVICES_FEE) {
                    const _s = _services_fee.Service_Fees;
                    const _t_op = `<option value="${_s.id}">${_s.name}</option>`;
                    fervices_fee_op += _t_op;
                }
                SELECT_GATE_IN_SERVICES_FEE.innerHTML = fervices_fee_op;
            }

            SELECT_GATE_IN.innerHTML = gateway_in_list;
            SELECT_GATE_OUT.innerHTML = gateway_out_list;
            SELECT_GATE_IN.value = localStorage.getItem('GATE_IN_ID');
            SELECT_GATE_OUT.value = localStorage.getItem('GATE_OUT_ID');
            SELECT_GATE_IN_SERVICES_FEE.value = localStorage.getItem('GATE_IN_SERVICES_FEE');

            if (SELECT_GATE_IN.value != null) {
                show_gate_in_data();

            }
            if (SELECT_GATE_OUT.value != null) {
                show_gate_out_data();

            }
            if (SELECT_GATE_IN_SERVICES_FEE.value != null) {
                show_gate_in_services_fee();

            }

        } catch (error) {
            await Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: error.message,
                footer: 'ข้อผิดพลาด การเชื่อมต่อระบบ!'
            })
            window.location.reload();
        }
    }
    setting_station();
    async function show_gate_in_data() {
        let _result = await fetchApi("/api/function/gateway_list/?id=" + SELECT_GATE_IN.value, "get", null, "json");
        if (_result.success) {
            print_info(_result.data);
            const _gateway = _result.data[0].GateWay;
            document.getElementById("input_config_gateway_in_id").innerHTML = _gateway.id;
            document.getElementById("input_config_gateway_in_image").src = _gateway.images_path;
            document.getElementById("input_config_gateway_in_type").value = _gateway.type;
            document.getElementById("input_config_gateway_in_date_created").value = _gateway.date_created;
            document.getElementById("input_config_gateway_in_status").value = _gateway.status;
            document.getElementById("input_config_gateway_in_remark").value = _gateway.remark;
        }
    }

    async function show_gate_out_data() {
        let _result = await fetchApi("/api/function/gateway_list/?id=" + SELECT_GATE_OUT.value, "get", null, "json");
        if (_result.success) {
            print_info(_result.data);
            const _gateway = _result.data[0].GateWay;
            document.getElementById("input_config_gateway_out_id").innerHTML = _gateway.id;
            document.getElementById("input_config_gateway_out_image").src = _gateway.images_path;
            document.getElementById("input_config_gateway_out_type").value = _gateway.type;
            document.getElementById("input_config_gateway_out_date_created").value = _gateway.date_created;
            document.getElementById("input_config_gateway_out_status").value = _gateway.status;
            document.getElementById("input_config_gateway_out_remark").value = _gateway.remark;
        }
    }

    async function show_gate_in_services_fee() {
        let _result = await fetchApi("/api/service_fees/?id=" + SELECT_GATE_IN_SERVICES_FEE.value, "get", null, "json");
        if (_result.success) {
            print_info(_result.data);
            const _services_fee = _result.data.Service_Fees;
        }
    }

    async function select_gate_in_chang() {
        print_info(SELECT_GATE_IN.value);
        show_gate_in_data();
    }

    function submit_config_gate_in() {
        localStorage.setItem('GATE_IN_ID', SELECT_GATE_IN.value);
        print_info(SELECT_GATE_IN.value);
        toastMixin.fire({
            timer: 1000,
            title: `ดำเนินการเรียบร้อยแล้ว  GATE ID : ${SELECT_GATE_IN.value}`,
            icon: "success",
        });
    }


    async function select_gate_out_chang() {
        print_info(SELECT_GATE_OUT.value);
        show_gate_out_data();
    }
    function submit_config_gate_out() {
        localStorage.setItem('GATE_OUT_ID', SELECT_GATE_OUT.value);
        print_info(SELECT_GATE_OUT.value);
        toastMixin.fire({
            timer: 1000,
            title: `ดำเนินการเรียบร้อยแล้ว  GATE ID : ${SELECT_GATE_OUT.value}`,
            icon: "success",
        });
    }

    function submit_config_gate_in_service_fee() {
        localStorage.setItem('GATE_IN_SERVICES_FEE', SELECT_GATE_IN_SERVICES_FEE.value);
        print_info(SELECT_GATE_IN_SERVICES_FEE.value);
        toastMixin.fire({
            timer: 1000,
            title: `ดำเนินการเรียบร้อยแล้ว  GATE IN SERVICES_FEE : ${SELECT_GATE_IN_SERVICES_FEE.value}`,
            icon: "success",
        });
    }

</script>



</html>